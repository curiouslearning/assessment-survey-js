var R=Object.defineProperty;var N=(l,e,t)=>e in l?R(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var n=(l,e,t)=>N(l,typeof e!="symbol"?e+"":e,t);import{l as f,i as D,g as P,v as U}from"./vendor.Bccc20rx.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function E(){var e=v().get("cr_user_id");return e==null&&(console.log("no uuid provided"),e="WebUserNoID"),e}function V(){var e=v().get("userSource");return e==null&&(console.log("no user source provided"),e="WebUserNoSource"),e}function S(){var e=v().get("data");return e==null&&(console.log("default data file"),e="zulu-lettersounds"),e}function v(){const l=window.location.search;return new URLSearchParams(l)}async function F(l){return L(l).then(e=>e)}async function q(l){return L(l).then(e=>e.questions)}async function G(l){return L(l).then(e=>e.buckets)}function M(l){return"/data/"+l+".json"}function O(){return["luganda"]}async function L(l){var e=M(l);return fetch(e).then(t=>t.json())}const d=class d{constructor(){n(this,"imageToCache",[]);n(this,"wavToCache",[]);n(this,"allAudios",{});n(this,"allImages",{});n(this,"dataURL","");n(this,"correctSoundPath","/audio/Correct.wav");n(this,"feedbackAudio",null);n(this,"correctAudio",null)}init(){this.feedbackAudio=new Audio,this.feedbackAudio.src=this.correctSoundPath,this.correctAudio=new Audio}static PrepareAudioAndImagesForSurvey(e,t){d.getInstance().dataURL=t;const s="audio/"+d.getInstance().dataURL+"/answer_feedback.mp3";d.getInstance().wavToCache.push(s),d.getInstance().correctAudio.src=s;for(var i in e){let r=e[i];r.promptAudio!=null&&d.FilterAndAddAudioToAllAudios(r.promptAudio.toLowerCase()),r.promptImg!=null&&d.AddImageToAllImages(r.promptImg);for(var a in r.answers){let u=r.answers[a];u.answerImg!=null&&d.AddImageToAllImages(u.answerImg)}}console.log(d.getInstance().allAudios),console.log(d.getInstance().allImages)}static AddImageToAllImages(e){console.log("Add image: "+e);let t=new Image;t.src=e,d.getInstance().allImages[e]=t}static FilterAndAddAudioToAllAudios(e){console.log("Adding audio: "+e),e.includes(".wav")?e=e.replace(".wav",".mp3"):e.includes(".mp3")||(e=e.trim()+".mp3"),console.log("Filtered: "+e);let t=new Audio;O().includes(d.getInstance().dataURL.split("-")[0]),t.src="audio/"+d.getInstance().dataURL+"/"+e,d.getInstance().allAudios[e]=t,console.log(t.src)}static PreloadBucket(e,t){d.getInstance().dataURL=t,d.getInstance().correctAudio.src="audio/"+d.getInstance().dataURL+"/answer_feedback.mp3";for(var s in e.items){var i=e.items[s];d.FilterAndAddAudioToAllAudios(i.itemName.toLowerCase())}}static PlayAudio(e,t,s){e=e.toLowerCase(),console.log("trying to play "+e),e.includes(".mp3")?e.slice(-4)!=".mp3"&&(e=e.trim()+".mp3"):e=e.trim()+".mp3",console.log("Pre play all audios: "),console.log(d.getInstance().allAudios),new Promise((a,r)=>{const u=d.getInstance().allAudios[e];u?(u.addEventListener("play",()=>{typeof s<"u"&&s(!0)}),u.addEventListener("ended",()=>{typeof s<"u"&&s(!1),a()}),u.play().catch(g=>{console.error("Error playing audio:",g),a()})):(console.warn("Audio file not found:",e),a())}).then(()=>{typeof t<"u"&&t()}).catch(a=>{console.error("Promise error:",a)})}static GetImage(e){return d.getInstance().allImages[e]}static PlayDing(){d.getInstance().feedbackAudio.play()}static PlayCorrect(){d.getInstance().correctAudio.play()}static getInstance(){return d.instance==null&&(d.instance=new d,d.instance.init()),d.instance}};n(d,"instance",null);let p=d;function I(l){return l[Math.floor(Math.random()*l.length)]}function A(l){for(let e=l.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[l[e],l[t]]=[l[t],l[e]]}}const c=class c{constructor(){n(this,"landingContainerId","landWrap");n(this,"landingContainer");n(this,"gameContainerId","gameWrap");n(this,"gameContainer");n(this,"endContainerId","endWrap");n(this,"endContainer");n(this,"starContainerId","starWrapper");n(this,"starContainer");n(this,"chestContainerId","chestWrapper");n(this,"chestContainer");n(this,"questionsContainerId","qWrap");n(this,"questionsContainer");n(this,"feedbackContainerId","feedbackWrap");n(this,"feedbackContainer");n(this,"answersContainerId","aWrap");n(this,"answersContainer");n(this,"answerButton1Id","answerButton1");n(this,"answerButton1");n(this,"answerButton2Id","answerButton2");n(this,"answerButton2");n(this,"answerButton3Id","answerButton3");n(this,"answerButton3");n(this,"answerButton4Id","answerButton4");n(this,"answerButton4");n(this,"answerButton5Id","answerButton5");n(this,"answerButton5");n(this,"answerButton6Id","answerButton6");n(this,"answerButton6");n(this,"playButtonId","pbutton");n(this,"playButton");n(this,"chestImgId","chestImage");n(this,"chestImg");n(this,"nextQuestion",null);n(this,"contentLoaded",!1);n(this,"qStart");n(this,"shown",!1);n(this,"stars",[]);n(this,"shownStarsCount",0);n(this,"starPositions",Array());n(this,"qAnsNum",0);n(this,"allStart");n(this,"buttons",[]);n(this,"buttonPressCallback");n(this,"startPressCallback");n(this,"buttonsActive",!1);n(this,"devModeCorrectLabelVisibility",!1)}init(){this.landingContainer=document.getElementById(this.landingContainerId),this.gameContainer=document.getElementById(this.gameContainerId),this.endContainer=document.getElementById(this.endContainerId),this.starContainer=document.getElementById(this.starContainerId),this.chestContainer=document.getElementById(this.chestContainerId),this.questionsContainer=document.getElementById(this.questionsContainerId),this.feedbackContainer=document.getElementById(this.feedbackContainerId),this.answersContainer=document.getElementById(this.answersContainerId),this.answerButton1=document.getElementById(this.answerButton1Id),this.answerButton2=document.getElementById(this.answerButton2Id),this.answerButton3=document.getElementById(this.answerButton3Id),this.answerButton4=document.getElementById(this.answerButton4Id),this.answerButton5=document.getElementById(this.answerButton5Id),this.answerButton6=document.getElementById(this.answerButton6Id),this.playButton=document.getElementById(this.playButtonId),this.chestImg=document.getElementById(this.chestImgId),this.initializeStars(),this.initEventListeners()}initializeStars(){for(let e=0;e<20;e++){const t=document.createElement("img");t.id="star"+e,t.classList.add("topstarv"),this.starContainer.appendChild(t),this.starContainer.innerHTML+="",e==9&&(this.starContainer.innerHTML+="<br>"),this.stars.push(e)}A(this.stars)}SetCorrectLabelVisibility(e){this.devModeCorrectLabelVisibility=e,console.log("Correct label visibility set to ",this.devModeCorrectLabelVisibility)}static OverlappingOtherStars(e,t,s,i){if(e.length<1)return!1;for(let a=0;a<e.length;a++){const r=e[a].x-t,u=e[a].y-s;if(Math.sqrt(r*r+u*u)<i)return!0}return!1}initEventListeners(){this.answerButton1.addEventListener("click",()=>{this.answerButtonPress(1)}),this.buttons.push(this.answerButton1),this.answerButton2.addEventListener("click",()=>{this.answerButtonPress(2)}),this.buttons.push(this.answerButton2),this.answerButton3.addEventListener("click",()=>{this.answerButtonPress(3)}),this.buttons.push(this.answerButton3),this.answerButton4.addEventListener("click",()=>{this.answerButtonPress(4)}),this.buttons.push(this.answerButton4),this.answerButton5.addEventListener("click",()=>{this.answerButtonPress(5)}),this.buttons.push(this.answerButton5),this.answerButton6.addEventListener("click",()=>{this.answerButtonPress(6)}),this.buttons.push(this.answerButton6),this.landingContainer.addEventListener("click",()=>{localStorage.getItem(S())&&this.showGame()})}showOptions(){if(!c.getInstance().shown){const e=c.getInstance().nextQuestion,t=c.getInstance().buttons;let s=220;const i=150;c.getInstance().shown=!0;let a=0;t.forEach(r=>{r.style.visibility="hidden",r.style.animation="",r.innerHTML=""}),setTimeout(()=>{for(let r=0;r<e.answers.length;r++){const u=e.answers[r],g=t[r],k=u.answerName===e.correct;if(g.innerHTML="answerText"in u?u.answerText:"",k&&c.getInstance().devModeCorrectLabelVisibility){const B=document.createElement("div");B.classList.add("correct-label"),B.innerHTML="Correct",g.appendChild(B)}g.style.visibility="hidden",g.style.boxShadow="0px 0px 0px 0px rgba(0,0,0,0)",setTimeout(()=>{if(g.style.visibility="visible",g.style.boxShadow="0px 6px 8px #606060",g.style.animation=`zoomIn ${s}ms ease forwards`,"answerImg"in u){const B=p.GetImage(u.answerImg);g.appendChild(B)}g.addEventListener("animationend",()=>{a++,a===e.answers.length&&c.getInstance().enableAnswerButton()})},r*s*.3)}},i),c.getInstance().qStart=Date.now()}}enableAnswerButton(){c.getInstance().buttonsActive=!0}static SetFeedbackText(e){console.log("Feedback text set to "+e),c.getInstance().feedbackContainer.innerHTML=e}showLanding(){this.landingContainer.style.display="flex",this.gameContainer.style.display="none",this.endContainer.style.display="none"}static ShowEnd(){c.getInstance().landingContainer.style.display="none",c.getInstance().gameContainer.style.display="none",c.getInstance().endContainer.style.display="flex"}showGame(){this.landingContainer.style.display="none",this.gameContainer.style.display="grid",this.endContainer.style.display="none",this.allStart=Date.now(),this.startPressCallback()}static SetFeedbackVisibile(e){e?(c.getInstance().feedbackContainer.classList.remove("hidden"),c.getInstance().feedbackContainer.classList.add("visible"),p.PlayCorrect(),c.getInstance().buttonsActive=!1):(c.getInstance().feedbackContainer.classList.remove("visible"),c.getInstance().feedbackContainer.classList.add("hidden"),c.getInstance().buttonsActive=!1)}static ReadyForNext(e){if(e!==null){console.log("ready for next!"),c.getInstance().answersContainer.style.visibility="hidden";for(var t in c.getInstance().buttons)c.getInstance().buttons[t].style.visibility="hidden";c.getInstance().shown=!1,c.getInstance().nextQuestion=e,c.getInstance().questionsContainer.innerHTML="",c.getInstance().questionsContainer.style.display="none",c.getInstance().playButton.innerHTML="<button id='nextqButton'><img class=audio-button width='100px' height='100px' src='/img/SoundButton_Idle.png' type='image/svg+xml'> </img></button>";var s=document.getElementById("nextqButton");s.addEventListener("click",function(){c.ShowQuestion(),p.PlayAudio(e.promptAudio,c.getInstance().showOptions,c.ShowAudioAnimation)})}}static ShowAudioAnimation(e=!1){const t=c.getInstance().playButton.querySelector("img");e?t.src="animation/SoundButton.gif":t.src="/img/SoundButton_Idle.png"}static ShowQuestion(e){c.getInstance().playButton.innerHTML="<button id='nextqButton'><img class=audio-button width='100px' height='100px' src='/img/SoundButton_Idle.png' type='image/svg+xml'> </img></button>";var t=document.getElementById("nextqButton");t.addEventListener("click",function(){console.log("next question button pressed"),console.log(e.promptAudio),"promptAudio"in e&&p.PlayAudio(e.promptAudio,void 0,c.ShowAudioAnimation)}),c.getInstance().answersContainer.style.visibility="visible";let s="";if(c.getInstance().questionsContainer.innerHTML="",typeof e>"u"&&(e=c.getInstance().nextQuestion),"promptImg"in e){var i=p.GetImage(e.promptImg);c.getInstance().questionsContainer.appendChild(i)}s+=e.promptText,s+="<BR>",c.getInstance().questionsContainer.innerHTML+=s;for(var a in c.getInstance().buttons)c.getInstance().buttons[a].style.visibility="hidden"}static AddStar(){var e=document.getElementById("star"+c.getInstance().stars[c.getInstance().qAnsNum]);e.src="../animation/Star.gif",e.classList.add("topstarv"),e.classList.remove("topstarh"),e.style.position="absolute";let t=c.instance.starContainer.offsetWidth,s=c.instance.starContainer.offsetHeight;console.log("Stars Container dimensions: ",t,s);let i=0,a=0;do i=Math.floor(Math.random()*(t-60)),a=Math.floor(Math.random()*s);while(c.OverlappingOtherStars(c.instance.starPositions,i,a,30));e.style.transform="scale(10)",e.style.transition="top 1s ease, left 1s ease, transform 0.5s ease",e.style.zIndex="500",e.style.top=window.innerHeight/2+"px",e.style.left=c.instance.gameContainer.offsetWidth/2-e.offsetWidth/2+"px",setTimeout(()=>{if(e.style.transition="top 2s ease, left 2s ease, transform 2s ease",i<t/2){const r=5+Math.random()*8;console.log("Rotating star to the right",r),e.style.transform="rotate(-"+r+"deg) scale(1)"}else{const r=5+Math.random()*8;console.log("Rotating star to the left",r),e.style.transform="rotate("+r+"deg) scale(1)"}e.style.left=20+i+"px",e.style.top=60+a+"px",setTimeout(()=>{e.style.filter="drop-shadow(0px 0px 10px yellow)"},1900)},1e3),c.instance.starPositions.push({x:i,y:a}),c.getInstance().qAnsNum+=1,c.getInstance().shownStarsCount+=1}static ChangeStarImageAfterAnimation(){var e=document.getElementById("star"+c.getInstance().stars[c.getInstance().qAnsNum-1]);e.src="../img/star_after_animation.gif"}answerButtonPress(e){const t=this.buttons.every(s=>s.style.visibility==="visible");if(console.log(this.buttonsActive,t),this.buttonsActive===!0){p.PlayDing();const i=Date.now()-this.qStart;console.log("answered in "+i),this.buttonPressCallback(e,i)}}static ProgressChest(){const e=document.getElementById("chestImage");let t=e.src;console.log("Chest Progression-->",e),console.log("Chest Progression-->",e.src);const s=parseInt(t.slice(-6,-4),10);console.log("Chest Progression number-->",s);const a=`img/chestprogression/TreasureChestOpen0${s%4+1}.svg`;e.src=a}static SetContentLoaded(e){c.getInstance().contentLoaded=e}static SetButtonPressAction(e){c.getInstance().buttonPressCallback=e}static SetStartAction(e){c.getInstance().startPressCallback=e}static getInstance(){return c.instance===null&&(c.instance=new c,c.instance.init()),c.instance}};n(c,"instance",null);let h=c;const o=class o{constructor(){}static getInstance(){return o.instance||(o.instance=new o),o.instance}static setAssessmentType(e){o.assessmentType=e}static getLocation(){console.log("starting to get location"),fetch("https://ipinfo.io/json?token=b6268727178610").then(e=>{if(console.log("got location response"),!e.ok)throw Error(e.statusText);return e.json()}).then(e=>{console.log(e),o.latlong=e.loc;var t=o.latlong.split(","),s=parseFloat(t[0]).toFixed(2),i=parseFloat(t[1]).toFixed(1);return o.clat=s,o.clon=i,o.latlong="",t=[],o.sendLocation(),{}}).catch(e=>{console.warn(`location failed to update! encountered error ${e.msg}`)})}static linkAnalytics(e,t){o.gana=e,o.dataURL=t}static setUuid(e,t){o.uuid=e,o.userSource=t}static sendInit(e,t){o.appVersion=e,o.contentVersion=t,o.getLocation();var s="user "+o.uuid+" opened the assessment";console.log(s),f(o.gana,"opened",{})}static getAppLanguageFromDataURL(e){return e&&e!==""&&e.includes("-")?e.split("-")[0]:"NotAvailable"}static getAppTypeFromDataURL(e){return e&&e!==""&&e.includes("-")?e.split("-")[1]:"NotAvailable"}static sendLocation(){var e="Sending User coordinates: "+o.uuid+" : "+o.clat+", "+o.clon;console.log(e),f(o.gana,"user_location",{user:o.uuid,lang:o.getAppLanguageFromDataURL(o.dataURL),app:o.getAppTypeFromDataURL(o.dataURL),latlong:o.joinLatLong(o.clat,o.clon)}),console.log("INITIALIZED EVENT SENT"),console.log("App Language: "+o.getAppLanguageFromDataURL(o.dataURL)),console.log("App Type: "+o.getAppTypeFromDataURL(o.dataURL)),console.log("App Version: "+o.appVersion),console.log("Content Version: "+o.contentVersion),f(o.gana,"initialized",{type:"initialized",clUserId:o.uuid,userSource:o.userSource,latLong:o.joinLatLong(o.clat,o.clon),appVersion:o.appVersion,contentVersion:o.contentVersion,app:o.getAppTypeFromDataURL(o.dataURL),lang:o.getAppLanguageFromDataURL(o.dataURL)})}static sendAnswered(e,t,s){var i=e.answers[t-1],a=null,r=null;"correct"in e&&e.correct!=null&&(e.correct==i.answerName?a=!0:a=!1),"bucket"in e&&(r=e.bucket);var u="user "+o.uuid+" answered "+e.qName+" with "+i.answerName;u+=", all answers were [";var g="";for(var k in e.answers)u+=e.answers[k].answerName+",",g+=e.answers[k].answerName+",";u+="] ",u+=a,u+=r,console.log(u),console.log("Answered App Version: "+o.appVersion),console.log("Content Version: "+o.contentVersion),f(o.gana,"answered",{type:"answered",clUserId:o.uuid,userSource:o.userSource,latLong:o.joinLatLong(o.clat,o.clon),app:o.getAppTypeFromDataURL(o.dataURL),lang:o.getAppLanguageFromDataURL(o.dataURL),dt:s,question_number:e.qNumber,target:e.qTarget,question:e.promptText,selected_answer:i.answerName,iscorrect:a,options:g,bucket:r,appVersion:o.appVersion,contentVersion:o.contentVersion})}static sendBucket(e,t){var s=e.bucketID,i=e.numTried,a=e.numCorrect,r="user "+o.uuid+" finished the bucket "+s+" with "+a+" correct answers out of "+i+" tried and passed: "+t;console.log(r),console.log("Bucket Completed App Version: "+o.appVersion),console.log("Content Version: "+o.contentVersion),f(o.gana,"bucketCompleted",{type:"bucketCompleted",clUserId:o.uuid,userSource:o.userSource,latLong:o.joinLatLong(o.clat,o.clon),app:o.getAppTypeFromDataURL(o.dataURL),lang:o.getAppLanguageFromDataURL(o.dataURL),bucketNumber:s,numberTriedInBucket:i,numberCorrectInBucket:a,passedBucket:t,appVersion:o.appVersion,contentVersion:o.contentVersion})}static sendFinished(e=null,t,s){let i="user "+o.uuid+" finished the assessment";console.log(i);let a=o.getBasalBucketID(e),r=o.getCeilingBucketID(e);a==0&&(a=r);let u=o.calculateScore(e,a);const g=e.length*100;console.log("Sending completed event"),console.log("Score: "+u),console.log("Max Score: "+g),console.log("Basal Bucket: "+a),console.log("BASAL FROM ASSESSMENT: "+t),console.log("Ceiling Bucket: "+r),console.log("CEILING FROM ASSESSMENT: "+s),console.log("Completed App Version: "+o.appVersion),console.log("Content Version: "+o.contentVersion),o.sendDataToThirdParty(u,o.uuid),f(o.gana,"completed",{type:"completed",clUserId:o.uuid,userSource:o.userSource,app:o.getAppTypeFromDataURL(o.dataURL),lang:o.getAppLanguageFromDataURL(o.dataURL),latLong:o.joinLatLong(o.clat,o.clon),score:u,maxScore:g,basalBucket:a,ceilingBucket:r,appVersion:o.appVersion,contentVersion:o.contentVersion})}static sendDataToThirdParty(e,t){console.log("Attempting to send score to a third party! Score: ",e);const s=new URLSearchParams(window.location.search),i=s.get("endpoint");s.get("organization");const a=new XMLHttpRequest;if(!i){console.error("No target party URL found!");return}const r={user:t,page:"111108121363615",event:{type:"external",value:{type:"assessment",subType:o.assessmentType,score:e,completed:!0}}},u=JSON.stringify(r);try{a.open("POST",i,!0),a.setRequestHeader("Content-Type","application/json"),a.onload=function(){a.status>=200&&a.status<300?console.log("POST success!"+a.responseText):console.error("Request failed with status: "+a.status)},a.send(u)}catch(g){console.error("Failed to send data to target party: ",g)}}static calculateScore(e,t){console.log("Calculating score"),console.log(e);let s=0;console.log("Basal Bucket ID: "+t);let i=0;for(const a in e){const r=e[a];if(r.bucketID==t){i=r.numCorrect;break}}return console.log("Num Correct: "+i," basal: "+t," buckets: "+e.length),t===e.length&&i>=4?(console.log("Perfect score"),e.length*100):(s=Math.round((t-1)*100+i/5*100)|0,s)}static getBasalBucketID(e){let t=0;for(const s in e){const i=e[s];i.tested&&!i.passed&&(t==0||i.bucketID<t)&&(t=i.bucketID)}return t}static getCeilingBucketID(e){let t=0;for(const s in e){const i=e[s];i.tested&&i.passed&&(t==0||i.bucketID>t)&&(t=i.bucketID)}return t}static joinLatLong(e,t){return e+","+t}};n(o,"uuid"),n(o,"userSource"),n(o,"clat"),n(o,"clon"),n(o,"gana"),n(o,"latlong"),n(o,"dataURL"),n(o,"appVersion"),n(o,"contentVersion"),n(o,"assessmentType"),n(o,"instance");let m=o;class T{constructor(){n(this,"app");n(this,"dataURL");n(this,"unityBridge");n(this,"devModeAvailable",!1);n(this,"isInDevMode",!1);n(this,"isCorrectLabelShown",!1);n(this,"devModeToggleButtonContainerId","devModeModalToggleButtonContainer");n(this,"devModeToggleButtonContainer");n(this,"devModeToggleButtonId","devModeModalToggleButton");n(this,"devModeToggleButton");n(this,"devModeModalId","devModeSettingsModal");n(this,"devModeSettingsModal");n(this,"devModeBucketGenSelectId","devModeBucketGenSelect");n(this,"devModeBucketGenSelect");n(this,"devModeCorrectLabelShownCheckboxId","devModeCorrectLabelShownCheckbox");n(this,"devModeCorrectLabelShownCheckbox");n(this,"toggleDevModeModal",()=>{this.devModeSettingsModal.style.display=="block"?this.devModeSettingsModal.style.display="none":this.devModeSettingsModal.style.display="block"});this.isInDevMode=window.location.href.includes("localhost")||window.location.href.includes("127.0.0.1")||window.location.href.includes("assessmentdev"),this.devModeToggleButtonContainer=document.getElementById(this.devModeToggleButtonContainerId),this.devModeSettingsModal=document.getElementById(this.devModeModalId),this.devModeBucketGenSelect=document.getElementById(this.devModeBucketGenSelectId),this.devModeBucketGenSelect.onchange=e=>{this.handleBucketGenModeChange(e)},this.devModeToggleButton=document.getElementById(this.devModeToggleButtonId),this.devModeToggleButton.onclick=this.toggleDevModeModal,this.devModeCorrectLabelShownCheckbox=document.getElementById(this.devModeCorrectLabelShownCheckboxId),this.devModeCorrectLabelShownCheckbox.onchange=()=>{this.isCorrectLabelShown=this.devModeCorrectLabelShownCheckbox.checked,this.handleCorrectLabelShownChange()},this.isInDevMode?this.devModeToggleButtonContainer.style.display="block":this.devModeToggleButtonContainer.style.display="none"}hideDevModeButton(){this.devModeToggleButtonContainer.style.display="none"}onEnd(){h.ShowEnd(),this.app.unityBridge.SendClose()}}class W extends T{constructor(t,s){super();n(this,"questionsData");n(this,"currentQuestionIndex");n(this,"handleBucketGenModeChange",()=>{console.log("Bucket Gen Mode Changed")});n(this,"handleCorrectLabelShownChange",()=>{console.log("Correct Label Shown Changed")});n(this,"startSurvey",()=>{h.ReadyForNext(this.getNextQuestion())});n(this,"onQuestionEnd",()=>{h.SetFeedbackVisibile(!1),this.currentQuestionIndex+=1,setTimeout(()=>{this.HasQuestionsLeft()?h.ReadyForNext(this.getNextQuestion()):(console.log("There are no questions left."),this.onEnd())},500)});n(this,"TryAnswer",(t,s)=>{m.sendAnswered(this.questionsData[this.currentQuestionIndex],t,s),h.SetFeedbackVisibile(!0),h.AddStar(),setTimeout(()=>{this.onQuestionEnd()},2e3)});n(this,"buildQuestionList",()=>q(this.app.dataURL));console.log("Survey initialized"),this.dataURL=t,this.unityBridge=s,this.currentQuestionIndex=0,h.SetButtonPressAction(this.TryAnswer),h.SetStartAction(this.startSurvey)}async Run(t){this.app=t,this.buildQuestionList().then(s=>{this.questionsData=s,p.PrepareAudioAndImagesForSurvey(this.questionsData,this.app.GetDataURL()),this.unityBridge.SendLoaded()})}HasQuestionsLeft(){return this.currentQuestionIndex<=this.questionsData.length-1}getNextQuestion(){var t=this.questionsData[this.currentQuestionIndex];return t}}class H{constructor(e){n(this,"value");n(this,"left");n(this,"right");this.value=e,this.left=null,this.right=null}}function y(l,e,t){if(l>e)return null;let s;if((l+e)%2===0&&t.size!==1){if(s=Math.floor((l+e)/2),s===0)return null}else do s=Math.floor((l+e)/2),s+=Math.floor(Math.random()*2);while(s>e||t.has(s));t.add(s);let i=new H(s);return i.left=y(l,s-1,t),i.right=y(s+1,e,t),i}class Q extends T{constructor(t,s){super();n(this,"unityBridge");n(this,"currentNode");n(this,"currentQuestion");n(this,"bucketArray");n(this,"questionNumber");n(this,"buckets");n(this,"currentBucket");n(this,"numBuckets");n(this,"basalBucket");n(this,"ceilingBucket");n(this,"currentLinearBucketIndex");n(this,"currentLinearTargetIndex");n(this,"bucketGenMode",0);n(this,"MAX_STARS_COUNT_IN_LINEAR_MODE",20);n(this,"startAssessment",()=>{h.ReadyForNext(this.getNextQuestion()),this.isInDevMode&&this.hideDevModeButton()});n(this,"buildBuckets",async t=>{if(this.buckets===void 0||this.buckets.length===0){var s=G(this.app.GetDataURL()).then(i=>{this.buckets=i,this.numBuckets=i.length,console.log("buckets: "+this.buckets),this.bucketArray=Array.from(Array(this.numBuckets),(g,k)=>k+1),console.log("empty array "+this.bucketArray);let a=new Set;a.add(0);let r=y(this.buckets[0].bucketID-1,this.buckets[this.buckets.length-1].bucketID,a),u=this.convertToBucketBST(r,this.buckets);console.log("Generated the buckets root ----------------------------------------------"),console.log(u),this.basalBucket=this.numBuckets+1,this.ceilingBucket=-1,this.currentNode=u,this.tryMoveBucket(!1)});return s}else{if(t===0)return new Promise((i,a)=>{let r=new Set;r.add(0);let u=y(this.buckets[0].bucketID-1,this.buckets[this.buckets.length-1].bucketID,r),g=this.convertToBucketBST(u,this.buckets);console.log("Generated the buckets root ----------------------------------------------"),console.log(g),this.basalBucket=this.numBuckets+1,this.ceilingBucket=-1,this.currentNode=g,this.tryMoveBucket(!1),i()});if(t===1)return new Promise((i,a)=>{this.currentLinearBucketIndex=0,this.currentLinearTargetIndex=0,this.tryMoveBucket(!1),i()})}});n(this,"convertToBucketBST",(t,s)=>{if(t===null)return t;let i=t.value;return t.value=s.find(a=>a.bucketID===i),t.left!==null&&(t.left=this.convertToBucketBST(t.left,s)),t.right!==null&&(t.right=this.convertToBucketBST(t.right,s)),t});n(this,"initBucket",t=>{this.currentBucket=t,this.currentBucket.usedItems=[],this.currentBucket.numTried=0,this.currentBucket.numCorrect=0,this.currentBucket.numConsecutiveWrong=0,this.currentBucket.tested=!0,this.currentBucket.passed=!1});n(this,"TryAnswer",(t,s)=>{this.bucketGenMode===0&&m.sendAnswered(this.currentQuestion,t,s),this.currentBucket.numTried+=1,this.currentQuestion.answers[t-1].answerName==this.currentQuestion.correct?(this.currentBucket.numCorrect+=1,this.currentBucket.numConsecutiveWrong=0,console.log("Answered correctly")):(this.currentBucket.numConsecutiveWrong+=1,console.log("Answered incorrectly, "+this.currentBucket.numConsecutiveWrong)),(this.bucketGenMode===1&&h.getInstance().shownStarsCount<this.MAX_STARS_COUNT_IN_LINEAR_MODE||this.bucketGenMode===0)&&h.AddStar(),h.SetFeedbackVisibile(!0),setTimeout(()=>{console.log("Completed first Timeout"),this.onQuestionEnd()},2e3)});n(this,"onQuestionEnd",()=>{let t=this.HasQuestionsLeft()?500:4e3;const s=()=>{h.SetFeedbackVisibile(!1),(this.bucketGenMode===1&&h.getInstance().shownStarsCount<this.MAX_STARS_COUNT_IN_LINEAR_MODE||this.bucketGenMode===0)&&h.ChangeStarImageAfterAnimation(),this.HasQuestionsLeft()?(this.bucketGenMode===1&&(this.currentLinearTargetIndex<this.buckets[this.currentLinearBucketIndex].items.length&&(this.currentLinearTargetIndex++,this.currentBucket.usedItems=[]),this.currentLinearTargetIndex>=this.buckets[this.currentLinearBucketIndex].items.length&&this.currentLinearBucketIndex<this.buckets.length&&(this.currentLinearBucketIndex++,this.currentLinearTargetIndex=0,this.tryMoveBucket(!1))),h.ReadyForNext(this.getNextQuestion())):(console.log("No questions left"),this.onEnd())};new Promise(a=>{setTimeout(()=>{a()},t)}).then(()=>{s()})});n(this,"getNextQuestion",()=>{if(this.bucketGenMode===1&&this.currentLinearTargetIndex>=this.buckets[this.currentLinearBucketIndex].items.length)return null;var t,s,i,a;if(this.bucketGenMode===0){do t=I(this.currentBucket.items);while(this.currentBucket.usedItems.includes(t));this.currentBucket.usedItems.push(t);do s=I(this.currentBucket.items);while(t==s);do i=I(this.currentBucket.items);while(t==i||s==i);do a=I(this.currentBucket.items);while(t==a||s==a||i==a)}else if(this.bucketGenMode===1){t=this.buckets[this.currentLinearBucketIndex].items[this.currentLinearTargetIndex],this.currentBucket.usedItems.push(t);do s=I(this.buckets[this.currentLinearBucketIndex].items);while(t==s);do i=I(this.buckets[this.currentLinearBucketIndex].items);while(t==i||s==i);do a=I(this.buckets[this.currentLinearBucketIndex].items);while(t==a||s==a||i==a)}let r=[t,s,i,a];A(r);var u={qName:"question-"+this.questionNumber+"-"+t.itemName,qNumber:this.questionNumber,qTarget:t.itemName,promptText:"",bucket:this.currentBucket.bucketID,promptAudio:t.itemName,correct:t.itemText,answers:[{answerName:r[0].itemName,answerText:r[0].itemText},{answerName:r[1].itemName,answerText:r[1].itemText},{answerName:r[2].itemName,answerText:r[2].itemText},{answerName:r[3].itemName,answerText:r[3].itemText}]};return this.currentQuestion=u,this.questionNumber+=1,u});n(this,"tryMoveBucket",t=>{this.bucketGenMode===0?this.tryMoveBucketRandomBST(t):this.bucketGenMode===1&&this.tryMoveBucketLinearArrayBased(t)});n(this,"tryMoveBucketRandomBST",t=>{const s=this.currentNode.value;this.currentBucket!=null&&(this.currentBucket.passed=t,m.sendBucket(this.currentBucket,t)),console.log("new  bucket is "+s.bucketID),p.PreloadBucket(s,this.app.GetDataURL()),this.initBucket(s)});n(this,"tryMoveBucketLinearArrayBased",t=>{const s=this.buckets[this.currentLinearBucketIndex];console.log("New Bucket: "+s.bucketID),p.PreloadBucket(s,this.app.GetDataURL()),this.initBucket(s)});n(this,"HasQuestionsLeft",()=>{var t=!0;return this.currentBucket.passed?!1:this.bucketGenMode===1?!(this.currentLinearBucketIndex>=this.buckets.length&&this.currentLinearTargetIndex>=this.buckets[this.currentLinearBucketIndex].items.length):(this.currentBucket.numCorrect>=4?(console.log("Passed this bucket "+this.currentBucket.bucketID),this.currentBucket.bucketID>=this.numBuckets?(console.log("Passed highest bucket"),this.currentBucket.passed=!0,this.bucketGenMode===0&&m.sendBucket(this.currentBucket,!0),h.ProgressChest(),t=!1):(console.log("Moving up bucket"),this.currentNode.right!=null?(h.ProgressChest(),console.log("Moving to right node"),this.bucketGenMode===0?this.currentNode=this.currentNode.right:this.currentLinearBucketIndex++,this.tryMoveBucket(!0)):(console.log("Reached root node"),this.currentBucket.passed=!0,this.bucketGenMode===0&&m.sendBucket(this.currentBucket,!0),h.ProgressChest(),t=!1))):(this.currentBucket.numConsecutiveWrong>=2||this.currentBucket.numTried>=5)&&(console.log("Failed this bucket "+this.currentBucket.bucketID),this.currentBucket.bucketID<this.basalBucket&&(this.basalBucket=this.currentBucket.bucketID),this.currentBucket.bucketID<=1?(console.log("Failed lowest bucket !"),t=!1,this.currentBucket.passed=!1,this.bucketGenMode===0&&m.sendBucket(this.currentBucket,!1)):(console.log("Moving down bucket !"),this.currentNode.left!=null?(console.log("Moving to left node"),this.bucketGenMode===0?this.currentNode=this.currentNode.left:this.currentLinearBucketIndex++,this.tryMoveBucket(!1)):(console.log("Reached root node !"),t=!1,this.currentBucket.passed=!1,this.bucketGenMode===0&&m.sendBucket(this.currentBucket,!1)))),t)});this.dataURL=t,this.unityBridge=s,this.questionNumber=0,console.log("app initialized"),h.SetButtonPressAction(this.TryAnswer),h.SetStartAction(this.startAssessment)}Run(t){this.app=t,this.buildBuckets(this.bucketGenMode).then(s=>{console.log(this.currentBucket),this.unityBridge.SendLoaded()})}handleBucketGenModeChange(t){this.bucketGenMode=parseInt(this.devModeBucketGenSelect.value),this.buildBuckets(this.bucketGenMode).then(()=>{})}handleCorrectLabelShownChange(){h.getInstance().SetCorrectLabelVisibility(this.isCorrectLabelShown)}onEnd(){m.sendFinished(this.buckets,this.basalBucket,this.ceilingBucket),h.ShowEnd(),this.app.unityBridge.SendClose()}}class z{constructor(){n(this,"unityReference");typeof Unity<"u"?this.unityReference=Unity:this.unityReference=null}SendMessage(e){this.unityReference!==null&&this.unityReference.call(e)}SendLoaded(){this.unityReference!==null?this.unityReference.call("loaded"):console.log("would call Unity loaded now")}SendClose(){this.unityReference!==null?this.unityReference.call("close"):console.log("would close Unity now")}}class j{constructor(e,t,s){n(this,"appName");n(this,"contentFilePath");n(this,"audioVisualResources");this.appName=e,this.contentFilePath=t,this.audioVisualResources=s}setAppName(e){this.appName=e}setContentFilePath(e){this.contentFilePath=e}setAudioVisualResources(e){this.audioVisualResources=e}addItemToAudioVisualResources(e){this.audioVisualResources.has(e)||this.audioVisualResources.add(e)}}const C="v1.0.6";let w=document.getElementById("loadingScreen");const b=new BroadcastChannel("as-message-channel");class X{constructor(){n(this,"dataURL");n(this,"unityBridge");n(this,"analytics");n(this,"game");n(this,"cacheModel");n(this,"lang","english");this.unityBridge=new z,console.log("Initializing app..."),this.dataURL=S(),this.cacheModel=new j(this.dataURL,this.dataURL,new Set);const t=D({apiKey:"AIzaSyB8c2lBVi26u7YRL9sxOP97Uaq3yN8hTl4",authDomain:"ftm-b9d99.firebaseapp.com",databaseURL:"https://ftm-b9d99.firebaseio.com",projectId:"ftm-b9d99",storageBucket:"ftm-b9d99.appspot.com",messagingSenderId:"602402387941",appId:"1:602402387941:web:7b1b1181864d28b49de10c",measurementId:"G-FF1159TGCF"}),s=P(t);this.analytics=s,f(s,"notification_received"),f(s,"test initialization event",{}),console.log("firebase initialized")}async spinUp(){window.addEventListener("load",()=>{console.log("Window Loaded!"),(async()=>(await F(this.dataURL).then(e=>{console.log("Assessment/Survey "+C+" initializing!"),console.log("App data loaded!"),console.log(e),this.cacheModel.setContentFilePath(M(this.dataURL)),h.SetFeedbackText(e.feedbackText);let t=e.appType,s=e.assessmentType;if(t=="survey")this.game=new W(this.dataURL,this.unityBridge);else if(t=="assessment"){let i=e.buckets;for(let a=0;a<i.length;a++)for(let r=0;r<i[a].items.length;r++){let u;e.quizName.includes("Luganda")||e.quizName.toLowerCase().includes("west african english")?u="/audio/"+this.dataURL+"/"+i[a].items[r].itemName.toLowerCase().trim()+".mp3":u="/audio/"+this.dataURL+"/"+i[a].items[r].itemName.trim()+".mp3",this.cacheModel.addItemToAudioVisualResources(u)}this.cacheModel.addItemToAudioVisualResources("/audio/"+this.dataURL+"/answer_feedback.mp3"),this.game=new Q(this.dataURL,this.unityBridge)}this.game.unityBridge=this.unityBridge,m.setUuid(E(),V()),m.linkAnalytics(this.analytics,this.dataURL),m.setAssessmentType(s),m.sendInit(C,e.contentVersion),this.game.Run(this)}),await this.registerServiceWorker(this.game)))()})}async registerServiceWorker(e){console.log("Registering service worker..."),"serviceWorker"in navigator?(new U("/dist/sw.js",{}).register().then(s=>{console.log("Service worker registered!"),this.handleServiceWorkerRegistation(s)}).catch(s=>{console.log("Service worker registration failed: "+s)}),navigator.serviceWorker.addEventListener("message",x),await navigator.serviceWorker.ready,console.log("Cache Model: "),console.log(this.cacheModel),localStorage.getItem(this.cacheModel.appName)==null?(console.log("WE DONT HAVE THIS ASSESSMENT< CACHING IT!"),w.style.display="flex",b.postMessage({command:"Cache",data:{appData:this.cacheModel}})):w.style.display="none",b.onmessage=s=>{console.log(s.data.command+" received from service worker!"),s.data.command=="Activated"&&localStorage.getItem(this.cacheModel.appName)==null&&b.postMessage({command:"Cache",data:{appData:this.cacheModel}})}):console.warn("Service workers are not supported in this browser.")}handleServiceWorkerRegistation(e){var t;try{(t=e==null?void 0:e.installing)==null||t.postMessage({type:"Registartion",value:this.lang})}catch(s){console.log("Service worker registration failed: "+s)}}GetDataURL(){return this.dataURL}}b.addEventListener("message",x);function x(l){if(l.data.msg=="Loading"){let e=parseInt(l.data.data.progress);$(l,e)}l.data.msg=="UpdateFound"&&(console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>.,update Found"),Y())}function $(l,e){let t=document.getElementById("progressBar");e<100?t.style.width=e+"%":e>=100&&(w.style.display="none",h.SetContentLoaded(!0),localStorage.setItem(l.data.data.bookName,"true"),K(l.data.data.bookName))}function K(l){if(window.Android){let e=localStorage.getItem(l)!==null;window.Android.cachedStatus(e)}}function Y(){let l=`Update Found.
Please accept the update by pressing Ok.`;confirm(l)==!0?window.location.reload():l="Update will happen on the next launch."}const J=new X;J.spinUp();
